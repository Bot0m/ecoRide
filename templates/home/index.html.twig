{% extends 'base.html.twig' %}

{% block title %}Ecoride - Accueil{% endblock %}

{% block body %}

<!-- Hero -->
<section class="relative h-screen pt-20 bg-cover bg-center bg-no-repeat" style="background-image: url('{{ asset('images/pexels-lkloeppel-577696.jpg') }}');">

    <div class="absolute inset-0 flex flex-col items-center justify-center text-center px-4">
        <!-- Carte glassmorphique horizontale -->
        <!-- Section Trajets du jour -->
        {% if app.user and todayRides|length > 0 %}
            <div class="w-full max-w-6xl backdrop-blur-xl backdrop-saturate-150 backdrop-contrast-125 bg-white/30 rounded-2xl shadow-2xl border border-white/30 p-6 mb-6">
                <h2 class="text-xl font-title text-textPrimary mb-4 text-center">Vos trajets du jour</h2>
                <div class="grid gap-4">
                    {% for ride in todayRides %}
                        {% include 'partials/_ride_card.html.twig' with {
                            'ride': ride,
                            'userParticipations': userParticipations,
                            'showTodayActions': true
                        } %}
                    {% endfor %}
                </div>
            </div>
        {% endif %}

        <div class="w-full max-w-6xl backdrop-blur-xl backdrop-saturate-150 backdrop-contrast-125 bg-white/30 rounded-2xl shadow-2xl border border-white/30 p-6 mb-6">
            <form method="get" action="{{ path('app_rides') }}" class="flex flex-wrap justify-center gap-2 md:gap-4">
                <div class="relative max-w-sm">
                    <label for="home-departure" class="block text-sm font-base text-textPrimary mb-2 text-left">Ville de départ</label>
                    <input
                        type="text"
                        name="departure"
                        id="home-departure"
                        placeholder="Nantes"
                        autocomplete="off"
                        class="w-full px-4 py-2 font-body text-secondary rounded-lg bg-backgroundDark text-textPrimary placeholder-tSecondaryLight border-accentDark focus:border-accentDark"
                    />
                    <div id="home-departure-suggestions" class="absolute top-full left-0 right-0 bg-backgroundDark border border-accentDark rounded-lg mt-1 max-h-60 overflow-y-auto z-50 hidden shadow-xl"></div>
                </div>
                <div class="relative max-w-sm">
                    <label for="home-arrival" class="block text-sm font-base text-textPrimary mb-2 text-left">Ville d'arrivée</label>
                    <input
                        type="text"
                        name="arrival"
                        id="home-arrival"
                        placeholder="Paris"
                        autocomplete="off"
                        class="w-full px-4 py-2 font-body text-secondary rounded-lg bg-backgroundDark text-textPrimary placeholder-tSecondaryLight border-accentDark focus:border-accentDark"
                    />
                    <div id="home-arrival-suggestions" class="absolute top-full left-0 right-0 bg-backgroundDark border border-accentDark rounded-lg mt-1 max-h-60 overflow-y-auto z-50 hidden shadow-xl"></div>
                </div>
                
                <div class="relative max-w-sm">
                    <label for="home-date" class="block text-sm font-base text-textPrimary mb-2 text-left">Date de départ</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                            <svg class="w-4 h-4 text-tSecondaryLight" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"/>
                            </svg>
                        </div>
                        <input name="date" type="text" 
                            id="home-date"
                            value="{{ 'now'|date('d/m/Y') }}"
                            readonly
                            class="w-full px-4 py-2 ps-10 font-body text-secondary rounded-lg bg-backgroundDark text-textPrimary placeholder-tSecondaryLight border-accentDark focus:border-accentDark cursor-pointer" 
                            placeholder="Sélectionner une date">
                    </div>
                </div>

                <div class="relative max-w-sm">
                    <label for="home-quantity-input" class="block text-sm font-base text-textPrimary mb-2 text-left">Nombre de passagers</label>
                    <input
                        type="number"
                        name="passengers"
                        id="home-quantity-input"
                        placeholder="Ex: 2"
                        value="1"
                        min="1"
                        max="7"
                        class="w-full px-4 py-2 font-body text-secondary rounded-lg bg-backgroundDark text-textPrimary placeholder-tSecondaryLight border-accentDark focus:border-accentDark"
                    />
                </div>

                <button type="submit" class="font-body text-base text-textSecondary hover:text-textPrimary bg-accent hover:bg-accentDark rounded-lg text-body px-4 py-2 transition-all duration-300">
                    Rechercher
                </button>
            </form>
        </div>
        <!-- Calendrier personnalisé sorti du conteneur glassmorphique -->
        <div id="home-date-picker" class="absolute bg-backgroundDark border border-accentDark rounded-lg mt-1 p-4 z-[100] hidden shadow-xl" style="max-height: 400px; overflow-y: auto;">
            <div class="flex items-center justify-between mb-4">
                <button type="button" id="home-prev-month" class="text-tSecondaryLight hover:text-textPrimary">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                </button>
                <h3 id="home-current-month" class="text-textPrimary font-base"></h3>
                <button type="button" id="home-next-month" class="text-tSecondaryLight hover:text-textPrimary">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                </button>
            </div>
            <div class="grid grid-cols-7 gap-1 mb-2" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.25rem;">
                <div class="text-center text-xs text-tSecondaryLight">Lun</div>
                <div class="text-center text-xs text-tSecondaryLight">Mar</div>
                <div class="text-center text-xs text-tSecondaryLight">Mer</div>
                <div class="text-center text-xs text-tSecondaryLight">Jeu</div>
                <div class="text-center text-xs text-tSecondaryLight">Ven</div>
                <div class="text-center text-xs text-tSecondaryLight">Sam</div>
                <div class="text-center text-xs text-tSecondaryLight">Dim</div>
            </div>
            <div id="home-calendar-days" class="gap-1" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.25rem;"></div>
        </div>
        <br>
        <h1 class="text-title font-title text-secondary">
            Bienvenue sur Ecoride,
            <br>
            réduisez vos coûts, réduisez votre impact
        </h1>
    </div>
</section>

<!-- Section A propos -->
<section id="qui-sommes-nous" class="bg-backgroundDark">
    <div class="grid max-w-screen-xl px-4 py-8 mx-auto lg:gap-8 xl:gap-0 lg:py-16 lg:grid-cols-12">
        <div class="mr-auto place-self-center lg:col-span-7">
            <h1 class="max-w-2xl mb-4 text-title font-title text-textPrimary tracking-tight leading-none md:text-5xl xl:text-6xl">Qui sommes nous ?</h1>
            <p class="max-w-2xl mb-6 text-base font-body text-textSecondary lg:mb-8 md:text-lg lg:text-xl">EcoRide est une plateforme innovante dédiée à la mobilité durable. Notre mission est de proposer des solutions pratiques et accessibles pour encourager des déplacements respectueux de l'environnement. Nous croyons que chaque trajet peut contribuer à un avenir plus propre, et nous mettons tout en œuvre pour rendre l'écomobilité plus simple et efficace pour tous. 
            <br>
            Notre ambition est de révolutionner la mobilité urbaine en mettant à disposition des outils intelligents pour une gestion plus verte des déplacements. Nous voulons sensibiliser, accompagner et proposer des alternatives concrètes pour permettre à chacun de contribuer à la transition écologique, sans compromis sur la praticité et le confort.</p>
        </div>
        <div class="hidden lg:mt-0 lg:col-span-5 lg:flex">
            <img src="{{ asset('images/pexels-davidgallie-28884704.jpg') }}" alt="pexels-davidgallie-28884704" class="rounded-lg shadow-lg transform hover:scale-105 hover:rotate-1 transition-all duration-300">
        </div>                
    </div>
</section>

<!-- Section A propo 2 -->
<section class="bg-center bg-cover bg-no-repeat bg-gray-500 bg-blend-multiply" style="background-image: url('{{ asset('images/pexels-pripicart-620335.jpg') }}');">
    <div class="px-4 mx-auto max-w-screen-xl text-center py-24 lg:py-56">
        <h1 class="mb-4 text-title font-title tracking-tight leading-none text-accent md:text-5xl lg:text-6xl">Pourquoi choisir EcoRide ?</h1>
        <br>
        <p class="mb-8 text-base font-body text-accentLight lg:text-xl sm:px-16 lg:px-48">Face aux défis environnementaux actuels, EcoRide s'engage à promouvoir une alternative aux modes de transport polluants. En choisissant notre solution, vous participez à une démarche écologique visant à réduire l'empreinte carbone des déplacements quotidiens.
        <br>
        Nous privilégions des pratiques responsables et des outils innovants pour rendre chaque trajet plus durable, tout en garantissant une expérience fluide et agréable.</p>
    </div>
</section>

<!-- Section Avis des utilisateurs -->
{% if topReviews|length > 0 %}
<section class="bg-backgroundDark py-24">
    <div class="max-w-screen-xl mx-auto px-4">
        <div class="text-center mb-16">
            <h2 class="text-3xl font-title text-textPrimary mb-6">Ce que disent nos utilisateurs</h2>
            <p class="text-textSecondary font-body text-lg">Découvrez les avis de nos utilisateurs satisfaits</p>
        </div>
        
        <div class="relative">
            <!-- Container pour les avis rotatifs -->
            <div id="reviewsCarousel" class="flex transition-transform duration-1000 ease-out">
                {% for review in topReviews %}
                    <div class="review-slide w-full flex-shrink-0 px-4">
                        <div class="max-w-2xl mx-auto">
                            <div class="bg-gradient-to-br from-accent/20 to-accent/10 backdrop-blur-sm rounded-2xl p-8 border border-accent/30 shadow-xl">
                                <!-- Note avec étoiles -->
                                <div class="flex justify-center mb-8">
                                    <div class="flex items-center">
                                        {% for i in 1..5 %}
                                            <svg class="w-8 h-8 {% if i <= review.rating %}text-accentDark{% else %}text-textSecondary/30{% endif %}" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                            </svg>
                                        {% endfor %}
                                        <span class="ml-3 text-textPrimary font-base text-lg">{{ review.rating }}/5</span>
                                    </div>
                                </div>
                                
                                <!-- Commentaire -->
                                {% if review.comment %}
                                    <blockquote class="text-center mb-10">
                                        <p class="text-xl font-body text-textPrimary italic leading-relaxed">"{{ review.comment }}"</p>
                                    </blockquote>
                                {% else %}
                                    <div class="text-center mb-10">
                                        <p class="text-xl font-body text-textPrimary italic leading-relaxed">"Excellent trajet, je recommande !"</p>
                                    </div>
                                {% endif %}
                                
                                <!-- Espacement entre commentaire et infos -->
                                <div class="h-6"></div>
                                
                                <!-- Informations de l'auteur et du trajet -->
                                <div class="text-center">
                                    <div class="mb-4">
                                        <p class="text-textPrimary font-base text-lg font-semibold mb-2">{{ review.author.pseudo }}</p>
                                        {% if review.participation and review.participation.ride %}
                                            <p class="text-textSecondary text-sm">{{ review.participation.ride.departure }} → {{ review.participation.ride.arrival }}</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
            
            <!-- Espacement supplémentaire -->
            <div class="h-8"></div>
            
            <!-- Indicateurs de navigation -->
            <div class="flex justify-center space-x-3">
                {% for i in 0..(topReviews|length - 1) %}
                    <button class="review-indicator w-4 h-4 rounded-full bg-accent/50 hover:bg-accent transition-colors duration-300 {% if i == 0 %}bg-accent{% endif %}" data-index="{{ i }}"></button>
                {% endfor %}
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- Modal de confirmation pour démarrer un trajet -->
<div id="startRideModal" class="fixed inset-0 bg-black bg-opacity-50 z-[60] hidden flex items-center justify-center">
    <div class="backdrop-blur-xl backdrop-saturate-150 backdrop-contrast-125 bg-white/30 rounded-2xl shadow-2xl border border-white/30 p-8 max-w-md mx-4 transform transition-all">
        <div class="text-center">
            <h3 class="text-subtitle font-title text-backgroundDark mb-2">Démarrer le trajet</h3>
            <p class="text-background mb-6" id="startRideText">
                Êtes-vous sûr de vouloir démarrer ce trajet ?
            </p>
            <div class="flex gap-4 justify-end">
                <button id="confirmStartRideBtn" class="bg-accent hover:bg-accentDark backdrop-blur-sm hover:backdrop-blur-md text-textSecondary hover:text-textPrimary font-base py-3 px-6 rounded-xl transition-all duration-300">
                    Oui, démarrer
                </button>
                <button id="cancelStartRideBtn" class="backdrop-blur-sm bg-background/40 border border-background/30 text-textPrimary font-base py-3 px-6 rounded-xl hover:bg-background/60 transition-all duration-300">
                    Annuler
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de confirmation pour terminer un trajet -->
<div id="completeRideModal" class="fixed inset-0 bg-black bg-opacity-50 z-[60] hidden flex items-center justify-center">
    <div class="backdrop-blur-xl backdrop-saturate-150 backdrop-contrast-125 bg-white/30 rounded-2xl shadow-2xl border border-white/30 p-8 max-w-md mx-4 transform transition-all">
        <div class="text-center">
            <h3 class="text-subtitle font-title text-backgroundDark mb-2">Terminer le trajet</h3>
            <p class="text-background mb-6" id="completeRideText">
                Êtes-vous sûr d'avoir terminé ce trajet ?
            </p>
            <div class="flex gap-4 justify-end">
                <button id="confirmCompleteRideBtn" class="bg-accent hover:bg-accentDark backdrop-blur-sm hover:backdrop-blur-md text-textSecondary hover:text-textPrimary font-base py-3 px-6 rounded-xl transition-all duration-300">
                    Oui, terminer
                </button>
                <button id="cancelCompleteRideBtn" class="backdrop-blur-sm bg-background/40 border border-background/30 text-textPrimary font-base py-3 px-6 rounded-xl hover:bg-background/60 transition-all duration-300">
                    Annuler
                </button>
            </div>
        </div>
    </div>
</div>


{{ importmap('city-autocomplete') }}

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialiser l'autocomplétion des villes
    if (typeof CityAutocomplete !== 'undefined') {
        new CityAutocomplete('home-departure', 'home-departure-suggestions');
        new CityAutocomplete('home-arrival', 'home-arrival-suggestions');
    }
    
    // Initialiser le carousel des avis
    initReviewsCarousel();
});

let rideToStart = null;
let rideToComplete = null;

// Fonctions pour gérer les trajets
function startRide(rideId) {
    rideToStart = rideId;
    document.getElementById('startRideModal').classList.remove('hidden');
}

function completeRide(rideId) {
    rideToComplete = rideId;
    document.getElementById('completeRideModal').classList.remove('hidden');
}

// Gestionnaires d'événements pour les modals
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('confirmStartRideBtn').addEventListener('click', function() {
        if (rideToStart) {
            fetch(`/ride/${rideToStart}/start`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('Erreur lors du démarrage du trajet');
                }
            })
            .catch(error => {
                console.error('Erreur:', error);
                alert('Erreur lors du démarrage du trajet');
            });
        }
        document.getElementById('startRideModal').classList.add('hidden');
        rideToStart = null;
    });

    document.getElementById('cancelStartRideBtn').addEventListener('click', function() {
        document.getElementById('startRideModal').classList.add('hidden');
        rideToStart = null;
    });

    document.getElementById('confirmCompleteRideBtn').addEventListener('click', function() {
        if (rideToComplete) {
            fetch(`/ride/${rideToComplete}/complete`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('Erreur lors de la terminaison du trajet');
                }
            })
            .catch(error => {
                console.error('Erreur:', error);
                alert('Erreur lors de la terminaison du trajet');
            });
        }
        document.getElementById('completeRideModal').classList.add('hidden');
        rideToComplete = null;
    });

    document.getElementById('cancelCompleteRideBtn').addEventListener('click', function() {
        document.getElementById('completeRideModal').classList.add('hidden');
        rideToComplete = null;
    });

    // Fermer les modals en cliquant en dehors
    document.getElementById('startRideModal').addEventListener('click', function(event) {
        if (event.target === this) {
            this.classList.add('hidden');
            rideToStart = null;
        }
    });

    document.getElementById('completeRideModal').addEventListener('click', function(event) {
        if (event.target === this) {
            this.classList.add('hidden');
            rideToComplete = null;
        }
    });
});

// Fonction pour gérer le carousel des avis
function initReviewsCarousel() {
    const carousel = document.getElementById('reviewsCarousel');
    const indicators = document.querySelectorAll('.review-indicator');
    const slides = document.querySelectorAll('.review-slide');
    
    if (!carousel || slides.length === 0) return;
    
    let currentIndex = 0;
    let interval;
    
    // Fonction pour afficher un avis spécifique
    function showSlide(index) {
        if (index < 0) index = slides.length - 1;
        if (index >= slides.length) index = 0;
        
        currentIndex = index;
        const translateX = -index * 100;
        carousel.style.transform = `translateX(${translateX}%)`;
        
        // Mettre à jour les indicateurs
        indicators.forEach((indicator, i) => {
            if (i === index) {
                indicator.classList.add('bg-accent');
                indicator.classList.remove('bg-accent/50');
            } else {
                indicator.classList.remove('bg-accent');
                indicator.classList.add('bg-accent/50');
            }
        });
    }
    
    // Fonction pour passer à l'avis suivant
    function nextSlide() {
        showSlide(currentIndex + 1);
    }
    
    // Démarrer la rotation automatique
    function startAutoRotation() {
        interval = setInterval(nextSlide, 10000); // 10 secondes
    }
    
    // Arrêter la rotation automatique
    function stopAutoRotation() {
        if (interval) {
            clearInterval(interval);
        }
    }
    
    // Gestionnaires d'événements pour les indicateurs
    indicators.forEach((indicator, index) => {
        indicator.addEventListener('click', () => {
            stopAutoRotation();
            showSlide(index);
            startAutoRotation(); // Redémarrer après interaction manuelle
        });
    });
    
    // Pause au survol
    carousel.addEventListener('mouseenter', stopAutoRotation);
    carousel.addEventListener('mouseleave', startAutoRotation);
    
    // Démarrer la rotation automatique
    startAutoRotation();
}

// Calendrier personnalisé pour la page d'accueil
class HomeDatePicker {
    constructor(inputId, pickerId, daysId, monthId, prevBtnId, nextBtnId) {
        this.input = document.getElementById(inputId);
        this.picker = document.getElementById(pickerId);
        this.daysContainer = document.getElementById(daysId);
        this.monthDisplay = document.getElementById(monthId);
        this.prevBtn = document.getElementById(prevBtnId);
        this.nextBtn = document.getElementById(nextBtnId);
        
        this.currentDate = new Date();
        this.selectedDate = new Date();
        
        this.init();
    }
    
    init() {
        this.renderCalendar();
        this.bindEvents();
    }
    
    renderCalendar() {
        const year = this.currentDate.getFullYear();
        const month = this.currentDate.getMonth();
        
        // Afficher le mois et l'année
        const monthNames = ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'];
        this.monthDisplay.textContent = `${monthNames[month]} ${year}`;
        
        // Obtenir le premier jour du mois et le nombre de jours
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const startDate = new Date(firstDay);
        startDate.setDate(startDate.getDate() - firstDay.getDay() + (firstDay.getDay() === 0 ? -6 : 1));
        
        this.daysContainer.innerHTML = '';
        
        // Générer les jours
        for (let i = 0; i < 42; i++) {
            const date = new Date(startDate);
            date.setDate(startDate.getDate() + i);
            
            const dayElement = document.createElement('div');
            dayElement.className = 'text-center p-2 cursor-pointer hover:bg-accent/20 rounded';
            
            // Vérifier si c'est le mois actuel
            if (date.getMonth() === month) {
                dayElement.classList.add('text-textPrimary');
                
                const today = new Date();
                const isToday = date.toDateString() === today.toDateString();
                const isSelected = date.toDateString() === this.selectedDate.toDateString();
                
                // Logique de coloration prioritaire
                if (isSelected) {
                    // Date sélectionnée (priorité la plus haute)
                    dayElement.classList.add('bg-accent', 'text-textSecondary');
                } else if (isToday) {
                    // Aujourd'hui mais non sélectionné
                    dayElement.style.backgroundColor = '#FFE0B2';
                    dayElement.style.color = '#3E2723';
                }
                
                // Vérifier si la date est dans le passé
                if (date < new Date().setHours(0, 0, 0, 0)) {
                    dayElement.classList.add('text-tSecondaryLight', 'cursor-not-allowed');
                } else {
                    dayElement.addEventListener('click', () => this.selectDate(date));
                }
            } else {
                dayElement.classList.add('text-tSecondaryLight');
            }
            
            dayElement.textContent = date.getDate();
            this.daysContainer.appendChild(dayElement);
        }
    }
    
    selectDate(date) {
        this.selectedDate = date;
        this.input.value = date.toLocaleDateString('fr-FR');
        
        // Créer un champ caché avec la date au format Y-m-d pour le formulaire
        let hiddenInput = document.querySelector(`input[name="date"][type="hidden"]`);
        if (!hiddenInput) {
            hiddenInput = document.createElement('input');
            hiddenInput.type = 'hidden';
            hiddenInput.name = 'date';
            this.input.parentNode.appendChild(hiddenInput);
        }
        hiddenInput.value = date.toISOString().split('T')[0];
        
        this.hidePicker();
        this.renderCalendar();
    }
    
    bindEvents() {
        this.input.addEventListener('click', () => this.togglePicker());
        
        this.prevBtn.addEventListener('click', () => {
            this.currentDate.setMonth(this.currentDate.getMonth() - 1);
            this.renderCalendar();
        });
        
        this.nextBtn.addEventListener('click', () => {
            this.currentDate.setMonth(this.currentDate.getMonth() + 1);
            this.renderCalendar();
        });
        
        // Fermer le calendrier en cliquant à l'extérieur
        document.addEventListener('click', (e) => {
            if (!this.picker.contains(e.target) && !this.input.contains(e.target)) {
                this.hidePicker();
            }
        });
    }
    
    togglePicker() {
        if (this.picker.classList.contains('hidden')) {
            this.showPicker();
        } else {
            this.hidePicker();
        }
    }
    
    showPicker() {
        this.picker.classList.remove('hidden');
        
        // Positionner le calendrier par rapport au champ de date
        const inputRect = this.input.getBoundingClientRect();
        this.picker.style.position = 'fixed';
        this.picker.style.top = (inputRect.bottom + 4) + 'px';
        this.picker.style.left = inputRect.left + 'px';
        this.picker.style.width = inputRect.width + 'px';
        
        // Vérifier si le calendrier déborde en bas
        setTimeout(() => {
            const pickerRect = this.picker.getBoundingClientRect();
            const viewportHeight = window.innerHeight;
            
            if (pickerRect.bottom > viewportHeight) {
                // Le calendrier déborde, le positionner au-dessus du champ
                this.picker.style.top = (inputRect.top - this.picker.offsetHeight - 4) + 'px';
            }
        }, 10);
    }
    
    hidePicker() {
        this.picker.classList.add('hidden');
        
        // Réinitialiser la position
        this.picker.style.position = '';
        this.picker.style.top = '';
        this.picker.style.left = '';
        this.picker.style.width = '';
    }
}

// Initialiser le calendrier de la page d'accueil
document.addEventListener('DOMContentLoaded', function() {
    new HomeDatePicker('home-date', 'home-date-picker', 'home-calendar-days', 'home-current-month', 'home-prev-month', 'home-next-month');
});
</script>

{% endblock %}

