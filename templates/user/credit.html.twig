{% extends 'user/base.html.twig' %}

{% block user_content %}
    <!-- En-t√™te de bienvenue -->
    <div class="bg-gradient-to-r from-accent/20 to-accent/10 backdrop-blur-sm rounded-2xl p-6 mb-8 border border-white/20">
        <h1 class="text-title font-title text-textPrimary mb-2">Bonjour {{ user.pseudo }} ! </h1>
        <p class="text-lg text-textSecondary">Bienvenue dans votre espace personnel Ecoride</p>
    </div>

    <!-- Carte des cr√©dits -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <div class="bg-gradient-to-br from-accent/20 to-accent/10 backdrop-blur-sm rounded-2xl p-6 border border-accent/30">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-subtitle font-title text-textPrimary">Mes cr√©dits</h2>
                <svg class="w-8 h-8 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/>
                </svg>
            </div>
            <p class="text-3xl font-title text-accent mb-4">{{ user.credits }}</p>
            <p class="text-body text-textSecondary mb-4">cr√©dits disponibles</p>
            <button onclick="openCreditModal()" class="inline-flex items-center bg-accent text-textSecondary hover:text-textPrimary font-base px-6 py-3 rounded-lg hover:bg-accentDark transition-all duration-300 shadow-lg hover:shadow-xl">
                Ajouter des cr√©dits
                <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                </svg>
            </button>
        </div>

        <!-- Carte activit√© r√©cente -->
        <div class="bg-gradient-to-br from-accent/20 to-accent/10 backdrop-blur-sm rounded-2xl p-6 border border-white/20">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-subtitle font-title text-textPrimary">Activit√© r√©cente</h2>
                <svg class="w-8 h-8 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
            </div>
            <p class="text-textSecondary mb-4">Aucun voyage r√©cent</p>
            <a href="{{ path('app_construction') }}" class="inline-flex items-center text-accent hover:text-accentDark font-base transition-colors duration-300">
                Voir tous mes voyages
                <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
            </a>
        </div>
    </div>

    <!-- Actions rapides -->
    <div class="bg-gradient-to-r from-secondary/20 to-background/50 backdrop-blur-sm rounded-2xl p-6 border border-white/20">
        <h2 class="text-subtitle font-title text-textPrimary mb-6">Actions rapides</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            <a href="{{ path('app_rides') }}" class="flex items-center gap-3 p-4 bg-accent/10 hover:bg-accent/20 rounded-lg transition-all duration-300 border border-accent/30 hover:border-accent/50">
                <svg class="w-6 h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
                <span class="font-base text-textPrimary">Rechercher un trajet</span>
            </a>
            
            <a href="{{ path('app_construction') }}" class="flex items-center gap-3 p-4 bg-secondary/20 hover:bg-secondary/30 rounded-lg transition-all duration-300 border border-white/20 hover:border-white/30">
                <svg class="w-6 h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                </svg>
                <span class="font-base text-textPrimary">Proposer un trajet</span>
            </a>
            
            <a href="{{ path('profile') }}" class="flex items-center gap-3 p-4 bg-secondary/20 hover:bg-secondary/30 rounded-lg transition-all duration-300 border border-white/20 hover:border-white/30">
                <svg class="w-6 h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
                <span class="font-base text-textPrimary">Modifier mon profil</span>
            </a>
        </div>
    </div>

    <!-- Modal d'ajout de cr√©dits -->
    <div id="creditModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="backdrop-blur-xl backdrop-saturate-150 backdrop-contrast-125 bg-white/30 rounded-2xl shadow-2xl border border-white/30 p-8 max-w-md mx-4 transform transition-all">
            <div class="text-center mb-6">
                <h3 class="text-subtitle font-title text-backgroundDark mb-2">Projet √âtudiant</h3>
                <p class="text-background">Dans le cadre de ce projet √©tudiant, l'ajout de cr√©dits est <strong>gratuit</strong> !</p>
                <p class="text-body text-background mt-2">Choisissez le nombre de cr√©dits √† ajouter :</p>
            </div>
            
            <div class="grid grid-cols-2 gap-4 mb-6">
                <button onclick="addCredits(10)" class="credit-btn bg-gradient-to-r from-accent to-accent/80 text-textSecondary hover:text-textPrimary font-base py-4 px-6 rounded-xl hover:from-accentDark hover:to-accent backdrop-blur-sm hover:backdrop-blur-md transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105">
                    +10 cr√©dits
                </button>
                <button onclick="addCredits(15)" class="credit-btn bg-gradient-to-r from-accent to-accent/80 text-textSecondary hover:text-textPrimary font-base py-4 px-6 rounded-xl hover:from-accentDark hover:to-accent backdrop-blur-sm hover:backdrop-blur-md transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105">
                    +15 cr√©dits
                </button>
                <button onclick="addCredits(20)" class="credit-btn bg-gradient-to-r from-accent to-accent/80 text-textSecondary hover:text-textPrimary font-base py-4 px-6 rounded-xl hover:from-accentDark hover:to-accent backdrop-blur-sm hover:backdrop-blur-md transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105">
                    +20 cr√©dits
                </button>
                <button onclick="addCredits(30)" class="credit-btn bg-gradient-to-r from-accent to-accent/80 text-textSecondary hover:text-textPrimary font-base py-4 px-6 rounded-xl hover:from-accentDark hover:to-accent backdrop-blur-sm hover:backdrop-blur-md transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105">
                    +30 cr√©dits
                </button>
            </div>
            
            <div class="text-center">
                <button onclick="closeCreditModal()" class="backdrop-blur-sm bg-background/40 border border-background/30 text-textPrimary font-base py-2 px-6 rounded-xl hover:bg-background/60 transition-all duration-300">
                    Annuler
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de succ√®s -->
    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="backdrop-blur-xl backdrop-saturate-150 backdrop-contrast-125 bg-white/30 rounded-2xl shadow-2xl border border-white/30 p-8 max-w-md mx-4 transform transition-all">
            <div class="text-center">
                <div class="text-6xl mb-4">üéâ</div>
                <h3 class="text-subtitle font-title text-backgroundDark mb-2">F√©licitations !</h3>
                <p id="successMessage" class="text-background mb-6"></p>
                <p class="text-lg font-base text-accent mb-6">
                    Nouveau solde : <span id="newCreditsDisplay" class="text-2xl"></span> cr√©dits
                </p>
                <button onclick="closeSuccessModal()" class="bg-accent hover:bg-accentDark backdrop-blur-sm hover:backdrop-blur-md text-textSecondary hover:text-textPrimary font-base py-3 px-6 rounded-xl transition-all duration-300">
                    Parfait !
                </button>
            </div>
        </div>
    </div>

    <script>
        function openCreditModal() {
            document.getElementById('creditModal').classList.remove('hidden');
        }

        function closeCreditModal() {
            document.getElementById('creditModal').classList.add('hidden');
        }

        function closeSuccessModal() {
            document.getElementById('successModal').classList.add('hidden');
            // Recharger la page pour mettre √† jour l'affichage des cr√©dits
            location.reload();
        }

        async function addCredits(amount) {
            // D√©sactiver tous les boutons pendant la requ√™te
            const buttons = document.querySelectorAll('.credit-btn');
            buttons.forEach(btn => {
                btn.disabled = true;
                btn.classList.add('opacity-50');
            });

            try {
                const response = await fetch('{{ path('credit_add') }}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ credits: amount })
                });

                const data = await response.json();

                if (data.success) {
                    // Fermer la modal d'ajout
                    closeCreditModal();
                    
                    // Afficher la modal de succ√®s
                    document.getElementById('successMessage').textContent = data.message;
                    document.getElementById('newCreditsDisplay').textContent = data.newCredits;
                    document.getElementById('successModal').classList.remove('hidden');
                } else {
                    alert('Erreur : ' + (data.error || 'Une erreur est survenue'));
                }
            } catch (error) {
                console.error('Erreur:', error);
                alert('Une erreur est survenue lors de l\'ajout des cr√©dits');
            } finally {
                // R√©activer les boutons
                buttons.forEach(btn => {
                    btn.disabled = false;
                    btn.classList.remove('opacity-50');
                });
            }
        }

        // Fermer la modal en cliquant en dehors
        document.getElementById('creditModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeCreditModal();
            }
        });

        document.getElementById('successModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSuccessModal();
            }
        });
    </script>
{% endblock %}